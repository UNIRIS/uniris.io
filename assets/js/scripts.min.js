/* ---------------------------------------------
 common scripts
 --------------------------------------------- */

 ; (function () {

    "use strict"; // use strict to start


    /* ---------------------------------------------
     wow animation
     --------------------------------------------- */

    new WOW().init();

    if ($(window).width() <= 991) {
        $(".wow").removeClass("wow");
    }


    /* ---------------------------------------------
     Smooth scrolling using jQuery easing
     --------------------------------------------- */

    $('a.js-scroll-trigger[href*="#"]:not([href="#"])').on('click', function () {
        if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
            var target = $(this.hash);
            target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
            if (target.length) {
                target.css('paddingTop', '50px');
                $('html, body').animate({
                    scrollTop: (target.offset().top)
                }, 1000);
                return false;
            }
        }
    });

    // Closes responsive menu when a scroll trigger link is clicked
    $('.js-scroll-trigger').on('click', function () {
        $('.navbar-collapse').collapse('hide');
    });

    $('.dropdown-item').on('click', function () {
        $('.dropdown-menu').removeClass('show');
    });

    // Activate scrollspy to add active class to navbar items on scroll
    $('body').scrollspy({
        target: '#mainNav'
    });


    /* ---------------------------------------------
     add sticky
     --------------------------------------------- */

    $(window).on('scroll', function () {
        var wSize = $(window).width();
        if (wSize > 767 && $(this).scrollTop() > 1) {
            $('.app-header').addClass("navbar-sticky");
        }
        else {
            $('.app-header').removeClass("navbar-sticky");
        }
    });


    /* ---------------------------------------------
     steps carousel
     --------------------------------------------- */

    $('.js_steps_carousel').owlCarousel({
        loop: true,
        margin: 0,
        autoplay: false,
        nav: false,
        //navText: ["<a><span></span></a>","<a><span></span></a>"],
        autoHeight: true,
        dots: true,
        dotsData: true,
        //animateOut: 'slideOutUp',
        //animateIn: 'slideInUp',
        responsive: {
            0: {
                items: 1
            },
            600: {
                items: 1
            },
            1000: {
                items: 1
            }
        }
    });

    /* ---------------------------------------------
     team carousel
     --------------------------------------------- */

    $('.js_team_member').owlCarousel({
        items: 5,
        loop: true,
        margin: 5,
        autoplay: false,
        nav: false,
        //navText: ["<a><span></span></a>","<a><span></span></a>"],
        autoHeight: true,
        dots: true,
        //animateOut: 'slideOutUp',
        //animateIn: 'slideInUp',
        responsive: {
            0: { items: 1, margin: 10 },
            480: { items: 2, margin: 10, center: true },
            599: { items: 2, margin: 10 },
            768: { items: 5, margin: 10, center: true },
            1170: { items: 5, margin: 10, center: true }
        }
    });

    /* ---------------------------------------------
     advisory board carousel
     --------------------------------------------- */

    $('.js_advisory_board').owlCarousel({
        loop: true,
        margin: 0,
        autoplay: false,
        nav: false,
        //navText: ["<a><span></span></a>","<a><span></span></a>"],
        autoHeight: true,
        dots: true,
        dotsData: true,
        //animateOut: 'slideOutUp',
        //animateIn: 'slideInUp',
        responsive: {
            0: {
                items: 1
            },
            600: {
                items: 1
            },
            1000: {
                items: 1
            }
        }
    });

    /* ---------------------------------------------
     road map carousel
     --------------------------------------------- */

    $('.js_road_map').owlCarousel({
        items: 5,
        nav: true,
        dots: true,
        margin: 30,
        navText: ["<i class='fa fa-angle-left'></i>", "<i class='fa fa-angle-right'></i>"],
        // navText: ["<svg class='fas fa-angle-left'></svg>", "<svg class='fas fa-angle-right'></svg>"],
        responsive: {
            0: { items: 1 },
            400: { items: 2, center: true },
            599: { items: 3 },
            1024: { items: 4 },
            1170: { items: 5 }
        }
    });

    /*==============================================
     Countdown
     ===============================================*/

    $('#counting-date').countdown('2019/12/12').on('update.countdown', function (event) {
        var $this = $(this).html(event.strftime(''
            + '<div class="count-block"><h2>%D</h2> <span>Days</span></div>' + '<span class="colon">:</span>'
            + '<div class="count-block"><h2>%H</h2> <span>Hours</span> </div>' + '<span class="colon">:</span>'
            + '<div class="count-block"><h2>%M</h2> <span>Minutes</span> </div>' + '<span class="colon">:</span>'
            + '<div class="count-block"><h2>%S</h2> <span>Seconds</span></div>'));
    });





    /*==============================================
     magnific popup
     ===============================================*/

    $(".popup-youtube, .popup-vimeo, .popup-gmaps").magnificPopup({
        disableOn: 700,
        type: "iframe",
        mainClass: "mfp-fade",
        removalDelay: 160,
        preloader: false,
        fixedContentPos: false
    });

    var YP_List = {
        "fr": "assets/yellowpapers/UNIRIS-YellowPaper-Saison1-Reseau.pdf",
        "en": "assets/yellowpapers/UNIRIS-YellowPaper-Season1-Network.pdf",
    }

    var end = new Date('2019/12/12')
    var today = new Date()
    var start = new Date('2019/09/16')
    var progress = Math.round(((today - start) / (end - start)) * 100)
    $('#progress-presale').css({ width: 40 * (progress / 100) + "%" })
    $('#progress-presale').attr('aria-valuenow', progress)

    
    function getPrice() {
        $.getJSON("https://api.coingecko.com/api/v3/simple/price?ids=archethic&vs_currencies=usd", function (data) {
            displayPrice(data.archethic.usd)
        })
    }

    function nFormatter(num, digits) {
        var si = [
          { value: 1, symbol: "" },
          { value: 1E3, symbol: "k" },
          { value: 1E6, symbol: "M" },
          { value: 1E9, symbol: "G" },
          { value: 1E12, symbol: "T" },
          { value: 1E15, symbol: "P" },
          { value: 1E18, symbol: "E" }
        ];
        var rx = /\.0+$|(\.[0-9]*[1-9])0+$/;
        var i;
        for (i = si.length - 1; i > 0; i--) {
          if (num >= si[i].value) {
            break;
          }
        }
        return (num / si[i].value).toFixed(digits).replace(rx, "$1") + si[i].symbol;
      }

    function displayPrice(price) {

        $.getJSON("https://ck7163lr1l.execute-api.us-east-1.amazonaws.com/default/uniris_circulating_supply", function (res) {
            if (res.circulating_supply == null) {
                return;
            } else {
                var market_cap = (res.circulating_supply * price).toPrecision(2)
                $("#market_cap").text(nFormatter(market_cap, 1))
                $("#circulating_supply").text(nFormatter(res.circulating_supply), 3)
            }
        })

        document.querySelector("#uco_price").innerText = price.toPrecision(4)
    }

    getPrice()
    // setInterval(function() { getPrice() }, 3000);

    $("#blockchain_io_btn").click(function() {
        fbq('trackCustom', 'BlockchainIO')
    })

    
    

})(jQuery);
